# çº¢å¤–å¯è§å…‰Agentç³»ç»Ÿ - æµ‹è¯•æ–‡æ¡£

æœ¬ç›®å½•åŒ…å«çº¢å¤–å¯è§å…‰Agentç³»ç»Ÿçš„æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ï¼Œå·²æŒ‰åŠŸèƒ½æ¨¡å—è¿›è¡Œæ‹†åˆ†ï¼Œä¾¿äºå•ç‹¬æµ‹è¯•å’Œç»´æŠ¤ã€‚

## ğŸ“ æµ‹è¯•æ–‡ä»¶ç»“æ„

```
tests/
â”œâ”€â”€ conftest.py              # pytesté…ç½®æ–‡ä»¶ï¼Œæä¾›å…±äº«å¤¹å…·
â”œâ”€â”€ run_tests.py             # æµ‹è¯•è¿è¡Œè„šæœ¬
â”œâ”€â”€ test_preprocess.py       # é¢„å¤„ç†å·¥å…·æµ‹è¯•
â”œâ”€â”€ test_fusion.py           # èåˆå·¥å…·æµ‹è¯•
â”œâ”€â”€ test_segment.py          # åˆ†å‰²å·¥å…·æµ‹è¯•
â”œâ”€â”€ test_metrics.py          # è¯„æµ‹å·¥å…·æµ‹è¯•
â”œâ”€â”€ test_report.py           # æŠ¥å‘Šç”Ÿæˆå·¥å…·æµ‹è¯•
â”œâ”€â”€ test_integration.py      # é›†æˆæµ‹è¯•
â”œâ”€â”€ test_data/               # æµ‹è¯•æ•°æ®ç›®å½•
â”œâ”€â”€ test_outputs/            # æµ‹è¯•è¾“å‡ºç›®å½•
â”œâ”€â”€ test_logs/               # æµ‹è¯•æ—¥å¿—ç›®å½•
â””â”€â”€ README.md               # æœ¬æ–‡ä»¶
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…æµ‹è¯•ä¾èµ–

```bash
pip install pytest pytest-cov numpy opencv-python matplotlib seaborn
```

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
# ä½¿ç”¨æµ‹è¯•è¿è¡Œè„šæœ¬
python tests/run_tests.py --all

# æˆ–ç›´æ¥ä½¿ç”¨pytest
pytest tests/ -v
```

### è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•

```bash
# è¿è¡Œé¢„å¤„ç†æ¨¡å—æµ‹è¯•
python tests/run_tests.py --module preprocess

# è¿è¡Œèåˆæ¨¡å—æµ‹è¯•
python tests/run_tests.py --module fusion

# è¿è¡Œåˆ†å‰²æ¨¡å—æµ‹è¯•
python tests/run_tests.py --module segment

# è¿è¡Œè¯„æµ‹æ¨¡å—æµ‹è¯•
python tests/run_tests.py --module metrics

# è¿è¡ŒæŠ¥å‘Šæ¨¡å—æµ‹è¯•
python tests/run_tests.py --module report

# è¿è¡Œé›†æˆæµ‹è¯•
python tests/run_tests.py --module integration
```

### è¿è¡Œç‰¹å®šæµ‹è¯•æ¨¡å¼

```bash
# è¿è¡ŒåŒ…å«"basic"çš„æµ‹è¯•
python tests/run_tests.py --pattern "basic"

# è¿è¡ŒåŒ…å«"edge"çš„æµ‹è¯•
python tests/run_tests.py --pattern "edge"
```

### ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š

```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
python tests/run_tests.py --all --coverage

# æˆ–ä½¿ç”¨pytest
pytest tests/ --cov=. --cov-report=html --cov-report=term
```

## ğŸ“‹ æµ‹è¯•æ¨¡å—è¯´æ˜

### 1. test_preprocess.py - é¢„å¤„ç†æµ‹è¯•

æµ‹è¯•å›¾åƒé¢„å¤„ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- åŸºæœ¬é¢„å¤„ç†åŠŸèƒ½
- å›¾åƒå°ºå¯¸è°ƒæ•´
- å›¾åƒå¢å¼º
- å›¾åƒå½’ä¸€åŒ–
- å›¾åƒé…å‡†
- ç›´æ–¹å›¾å‡è¡¡åŒ–
- é™å™ªå¤„ç†
- ä¼½é©¬æ ¡æ­£
- è¾¹ç¼˜æƒ…å†µå¤„ç†

**è¿è¡Œæ–¹å¼ï¼š**
```bash
python tests/run_tests.py --module preprocess
```

### 2. test_fusion.py - èåˆæµ‹è¯•

æµ‹è¯•å›¾åƒèåˆåŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- åŠ æƒå¹³å‡èåˆ
- æ‹‰æ™®æ‹‰æ–¯é‡‘å­—å¡”èåˆ
- ç¦»æ•£å°æ³¢å˜æ¢èåˆ
- ä¸»æˆåˆ†åˆ†æèåˆ
- è”åˆä»»åŠ¡èåˆ
- å¯¹æ¯”åº¦å¢å¼º
- ä¸åŒæƒé‡é…ç½®
- è¾¹ç¼˜æƒ…å†µå¤„ç†

**è¿è¡Œæ–¹å¼ï¼š**
```bash
python tests/run_tests.py --module fusion
```

### 3. test_segment.py - åˆ†å‰²æµ‹è¯•

æµ‹è¯•å›¾åƒåˆ†å‰²åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- é˜ˆå€¼åˆ†å‰²
- åˆ†æ°´å²­åˆ†å‰²
- K-meansåˆ†å‰²
- GrabCutåˆ†å‰²
- è½®å»“æ£€æµ‹åˆ†å‰²
- å½¢æ€å­¦æ“ä½œ
- åå¤„ç†
- ç½®ä¿¡åº¦è®¡ç®—
- ä¸åŒé…ç½®æµ‹è¯•

**è¿è¡Œæ–¹å¼ï¼š**
```bash
python tests/run_tests.py --module segment
```

### 4. test_metrics.py - è¯„æµ‹æµ‹è¯•

æµ‹è¯•è´¨é‡è¯„æµ‹åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- èåˆè´¨é‡è¯„ä¼°ï¼ˆç†µã€äº’ä¿¡æ¯ã€Qabfã€SSIMã€PSNRï¼‰
- åˆ†å‰²è´¨é‡è¯„ä¼°ï¼ˆmIoUã€Diceã€ç²¾ç¡®ç‡ã€å¬å›ç‡ã€F1åˆ†æ•°ï¼‰
- ç°åº¦å›¾åƒè¯„æµ‹
- å®Œç¾åŒ¹é…æµ‹è¯•
- æ— é‡å æµ‹è¯•
- è¾¹ç¼˜æƒ…å†µå¤„ç†
- é…ç½®æµ‹è¯•

**è¿è¡Œæ–¹å¼ï¼š**
```bash
python tests/run_tests.py --module metrics
```

### 5. test_report.py - æŠ¥å‘Šæµ‹è¯•

æµ‹è¯•æŠ¥å‘Šç”ŸæˆåŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- HTMLæŠ¥å‘Šç”Ÿæˆ
- JSONæŠ¥å‘Šç”Ÿæˆ
- å›¾åƒå¯¹æ¯”å›¾åˆ›å»º
- æŒ‡æ ‡å¯è§†åŒ–
- æ‰§è¡Œæ—¶é—´çº¿
- æŒ‡æ ‡è¡¨æ ¼
- ä¸åŒé…ç½®æµ‹è¯•
- è¾¹ç¼˜æƒ…å†µå¤„ç†

**è¿è¡Œæ–¹å¼ï¼š**
```bash
python tests/run_tests.py --module report
```

### 6. test_integration.py - é›†æˆæµ‹è¯•

æµ‹è¯•å®Œæ•´å¤„ç†æµç¨‹ï¼ŒåŒ…æ‹¬ï¼š
- å®Œæ•´å¤„ç†æµç¨‹
- è”åˆèåˆæµç¨‹
- ä¸åŒæ–¹æ³•ç»„åˆ
- é”™è¯¯å¤„ç†
- æ•°æ®æµéªŒè¯
- æ€§èƒ½æµ‹è¯•
- ç³»ç»Ÿé›†æˆæµ‹è¯•

**è¿è¡Œæ–¹å¼ï¼š**
```bash
python tests/run_tests.py --module integration
```

## ğŸ”§ æµ‹è¯•é…ç½®

### conftest.py é…ç½®

`conftest.py` æ–‡ä»¶æä¾›äº†ä»¥ä¸‹å…±äº«å¤¹å…·ï¼š

- `sample_images`: æ ·ä¾‹å›¾åƒæ•°æ®
- `sample_masks`: æ ·ä¾‹æ©ç æ•°æ®
- `sample_configs`: æ ·ä¾‹é…ç½®æ•°æ®
- `temp_dir`: ä¸´æ—¶ç›®å½•
- `sample_metrics`: æ ·ä¾‹æŒ‡æ ‡æ•°æ®
- `sample_execution_steps`: æ ·ä¾‹æ‰§è¡Œæ­¥éª¤æ•°æ®
- `edge_case_images`: è¾¹ç¼˜æƒ…å†µå›¾åƒæ•°æ®
- `test_data_path`: æµ‹è¯•æ•°æ®è·¯å¾„

### æµ‹è¯•æ ‡è®°

ç³»ç»Ÿè‡ªåŠ¨ä¸ºæµ‹è¯•æ·»åŠ ä»¥ä¸‹æ ‡è®°ï¼š

- `@pytest.mark.preprocess`: é¢„å¤„ç†ç›¸å…³æµ‹è¯•
- `@pytest.mark.fusion`: èåˆç›¸å…³æµ‹è¯•
- `@pytest.mark.segmentation`: åˆ†å‰²ç›¸å…³æµ‹è¯•
- `@pytest.mark.metrics`: è¯„æµ‹ç›¸å…³æµ‹è¯•
- `@pytest.mark.report`: æŠ¥å‘Šç›¸å…³æµ‹è¯•
- `@pytest.mark.integration`: é›†æˆæµ‹è¯•
- `@pytest.mark.unit`: å•å…ƒæµ‹è¯•

### è¿è¡Œç‰¹å®šæ ‡è®°çš„æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰é¢„å¤„ç†æµ‹è¯•
pytest tests/ -m preprocess

# è¿è¡Œæ‰€æœ‰èåˆæµ‹è¯•
pytest tests/ -m fusion

# è¿è¡Œæ‰€æœ‰é›†æˆæµ‹è¯•
pytest tests/ -m integration
```

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡

### æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Š

```bash
# ç”ŸæˆHTMLè¦†ç›–ç‡æŠ¥å‘Š
pytest tests/ --cov=. --cov-report=html

# æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Š
open htmlcov/index.html
```

### è¦†ç›–ç‡ç›®æ ‡

- å•å…ƒæµ‹è¯•è¦†ç›–ç‡ï¼š> 90%
- é›†æˆæµ‹è¯•è¦†ç›–ç‡ï¼š> 80%
- æ€»ä½“è¦†ç›–ç‡ï¼š> 85%

## ğŸ› è°ƒè¯•æµ‹è¯•

### è¯¦ç»†è¾“å‡º

```bash
# è¯¦ç»†è¾“å‡º
python tests/run_tests.py --verbose

# æˆ–ä½¿ç”¨pytest
pytest tests/ -v -s
```

### è¿è¡Œå•ä¸ªæµ‹è¯•

```bash
# è¿è¡Œç‰¹å®šæµ‹è¯•å‡½æ•°
pytest tests/test_preprocess.py::TestPreprocess::test_preprocess_basic -v

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
pytest tests/test_fusion.py::TestFusion -v
```

### è°ƒè¯•æ¨¡å¼

```bash
# åœ¨å¤±è´¥æ—¶è¿›å…¥è°ƒè¯•å™¨
pytest tests/ --pdb

# åœ¨ç¬¬ä¸€ä¸ªå¤±è´¥æ—¶åœæ­¢
pytest tests/ -x
```

## ğŸ“ æ·»åŠ æ–°æµ‹è¯•

### 1. åˆ›å»ºæµ‹è¯•æ–‡ä»¶

```python
# tests/test_new_module.py
import pytest
import numpy as np
from tools.new_module import new_function

class TestNewModule:
    def test_new_function_basic(self):
        """æµ‹è¯•æ–°åŠŸèƒ½çš„åŸºæœ¬åŠŸèƒ½"""
        # æµ‹è¯•ä»£ç 
        pass
    
    def test_new_function_edge_cases(self):
        """æµ‹è¯•æ–°åŠŸèƒ½çš„è¾¹ç¼˜æƒ…å†µ"""
        # æµ‹è¯•ä»£ç 
        pass
```

### 2. ä½¿ç”¨å…±äº«å¤¹å…·

```python
def test_with_fixtures(sample_images, temp_dir):
    """ä½¿ç”¨å…±äº«å¤¹å…·çš„æµ‹è¯•"""
    ir_img = sample_images["ir_medium"]
    # æµ‹è¯•ä»£ç 
    pass
```

### 3. æ·»åŠ æµ‹è¯•æ ‡è®°

```python
@pytest.mark.new_module
def test_new_function():
    """æ ‡è®°ä¸ºæ–°æ¨¡å—æµ‹è¯•"""
    pass
```

## ğŸ” æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•ç»“æ„

- æ¯ä¸ªæµ‹è¯•å‡½æ•°åªæµ‹è¯•ä¸€ä¸ªåŠŸèƒ½
- ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•å‡½æ•°å
- åŒ…å«åŸºæœ¬åŠŸèƒ½ã€è¾¹ç¼˜æƒ…å†µå’Œé”™è¯¯å¤„ç†æµ‹è¯•

### 2. æµ‹è¯•æ•°æ®

- ä½¿ç”¨ `conftest.py` ä¸­çš„å…±äº«å¤¹å…·
- åˆ›å»ºæœ‰æ„ä¹‰çš„æµ‹è¯•æ•°æ®
- æµ‹è¯•ä¸åŒå°ºå¯¸å’Œç±»å‹çš„å›¾åƒ

### 3. æ–­è¨€

- ä½¿ç”¨æ˜ç¡®çš„æ–­è¨€
- æ£€æŸ¥è¿”å›å€¼çš„ç±»å‹å’ŒèŒƒå›´
- éªŒè¯æ•°æ®å½¢çŠ¶å’Œå†…å®¹

### 4. é”™è¯¯å¤„ç†

- æµ‹è¯•å¼‚å¸¸æƒ…å†µ
- éªŒè¯é”™è¯¯æ¶ˆæ¯
- ç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿä¼˜é›…åœ°å¤„ç†é”™è¯¯

## ğŸ“ˆ æ€§èƒ½æµ‹è¯•

### è¿è¡Œæ€§èƒ½æµ‹è¯•

```bash
# è¿è¡Œæ€§èƒ½æµ‹è¯•
python tests/run_tests.py --pattern "performance"
```

### æ€§èƒ½åŸºå‡†

- é¢„å¤„ç†æ—¶é—´ï¼š< 10ç§’ï¼ˆ512x512å›¾åƒï¼‰
- èåˆæ—¶é—´ï¼š< 10ç§’ï¼ˆ512x512å›¾åƒï¼‰
- åˆ†å‰²æ—¶é—´ï¼š< 10ç§’ï¼ˆ512x512å›¾åƒï¼‰
- è¯„æµ‹æ—¶é—´ï¼š< 5ç§’
- æŠ¥å‘Šç”Ÿæˆæ—¶é—´ï¼š< 10ç§’

## ğŸš¨ å¸¸è§é—®é¢˜

### 1. å¯¼å…¥é”™è¯¯

ç¡®ä¿é¡¹ç›®æ ¹ç›®å½•åœ¨Pythonè·¯å¾„ä¸­ï¼š

```python
import sys
from pathlib import Path
sys.path.insert(0, str(Path(__file__).parent.parent))
```

### 2. ä¾èµ–é—®é¢˜

å®‰è£…æ‰€æœ‰å¿…è¦çš„ä¾èµ–ï¼š

```bash
pip install -r requirements.txt
pip install pytest pytest-cov
```

### 3. å†…å­˜é—®é¢˜

å¯¹äºå¤§å›¾åƒæµ‹è¯•ï¼Œå¯èƒ½éœ€è¦å¢åŠ å†…å­˜é™åˆ¶æˆ–ä½¿ç”¨è¾ƒå°çš„æµ‹è¯•å›¾åƒã€‚

### 4. ä¸´æ—¶æ–‡ä»¶æ¸…ç†

æµ‹è¯•ä¼šè‡ªåŠ¨æ¸…ç†ä¸´æ—¶æ–‡ä»¶ï¼Œä½†å¦‚æœæµ‹è¯•ä¸­æ–­ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨æ¸…ç†ï¼š

```bash
rm -rf tests/test_outputs/*
rm -rf tests/test_logs/*
```

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°æµ‹è¯•é—®é¢˜ï¼Œè¯·ï¼š

1. æ£€æŸ¥æµ‹è¯•è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯
2. ç¡®è®¤æ‰€æœ‰ä¾èµ–å·²æ­£ç¡®å®‰è£…
3. éªŒè¯æµ‹è¯•æ•°æ®æ˜¯å¦æ­£ç¡®
4. æŸ¥çœ‹ç›¸å…³æ¨¡å—çš„æ–‡æ¡£

---

**æ³¨æ„ï¼š** è¿è¡Œæµ‹è¯•å‰è¯·ç¡®ä¿å·²å®‰è£…æ‰€æœ‰å¿…è¦çš„ä¾èµ–åŒ…ï¼Œå¹¶ä¸”é¡¹ç›®ç»“æ„å®Œæ•´ã€‚
